<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <title>曹逸君 Blog - </title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">曹逸君 Blog </a></h1>
                <nav><ul>
                    <li><a href="/category/misc.html">misc</a></li>
                </ul></nav>
        </header><!-- /#banner -->

                <section id="content" class="body">
                    <ol id="posts-list" class="hfeed" start="6">
            <li><article class="hentry">
                <header>
                    <h1><a href="/tongji-university-electrictiy-balance-low-warner.html" rel="bookmark"
                           title="Permalink to 同济电费过低提醒">同济电费过低提醒</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-11-19T22:47:29">
                二 19 十一月 2013
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/cao-yi-jun.html">曹逸君</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>. </p>
<p>tags: <a href="/tag/.html"></a></p>
</footer><!-- /.post-info -->                <p>这要从几天前宿舍突然断电说起。代码敲得正欢，卡擦。没电了。网也断了（路由断电）。</p>
<p>坑爹呢这是，宿舍一伙人第一反映，没电费了，赶紧去交。交完发现，其实我们还有200Kwh剩余。</p>
<p>又交了400￥.于是就有了800Kwh，估计一年都有可能用不完。而断电只是由于不明原因跳闸。</p>
<p>电费系统坑点：</p>
<p>1.预冲式，没电费了直接断电，无提示。</p>
<p>2.缴费终端查询和缴费分开，只缴费是看不到剩余的。</p>
<p>3.钱交了，想退恐怕是极难的。</p>
<p>同济有个能源网可以查剩余电量。一天一更新。<a href="nyglzx.tongji.edu.cn/web/datastat.aspx">nyglzx.tongji.edu.cn/web/datastat.aspx</a></p>
<p>这次被坑后，我含着悲愤，写了个自动检测电量得脚本<a href="https://github.com/c19/TJwarner">github repo</a></p>
<p>电量低于一点值，比如10Kwh就发邮件到我邮箱提醒我。</p>
<p>然后又想了，其他小伙伴说不定也有这个需求，就写了个简单得页面放到服务器上提供电费过低提示功能。</p>
<p>脚本写的很简陋、很难看。如果需求大得话继续改进吧。</p>
<p>话说一句print ...</p>
                <a class="readmore" href="/tongji-university-electrictiy-balance-low-warner.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/why-company-will-die-out.html" rel="bookmark"
                           title="Permalink to 为什么公司必亡">为什么公司必亡</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-11-12T16:50:51">
                二 12 十一月 2013
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/cao-yi-jun.html">曹逸君</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>. </p>
<p>tags: <a href="/tag/.html"></a></p>
</footer><!-- /.post-info -->                <p>一个游戏公司，一个网页游戏开发团队包括设计师需要30+人。
他们用C++写业务逻辑，声称那样更稳定。</p>
<p>我认识得页游小团队除了投资人整个就只有6人。美工外包。
他们用clojure。</p>
<p>一个网络广告公司（网络广告投放）IT团队有60人，人人做得事情都不重复。
HR不懂技术分不清运维、C/C++程序员、android开发等等。</p>
<p>而事实上搜索引擎得广告投递根本不需要这种公司代理，页面上简单操作就能顺利投递，实时查看收益。</p>
<p>公司的内耗十分严重，公司所有者不信任执行者，会使用更容易找到替换人员得技术，把职能分得更细，而只要把所有者和执行者分开，就会有这种问题。</p>
<p>黑客和画家对此已有详细得论述。</p>
<p>可喜的是看到不少小团队开始去公司化，没有经理职位。没有高级头衔。执行者既是所有者。</p>
<p>相信将来这样的高效、全能得小团队将会击溃各种传统腐朽冗杂的大小公司。</p>
                <a class="readmore" href="/why-company-will-die-out.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/git-hooks-auto-email.html" rel="bookmark"
                           title="Permalink to git hooks 发送邮件">git hooks 发送邮件</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-11-11T21:41:33">
                一 11 十一月 2013
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/cao-yi-jun.html">曹逸君</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>. </p>
<p>tags: <a href="/tag/.html"></a></p>
</footer><!-- /.post-info -->                <p>前面用git得<code>post-receive</code>钩子实现了自动部署，很是舒畅，然后想着自动群发个邮件，项目组得人都能及时得知仓库更新、项目进度岂不是很好。</p>
<p>我搜到得实现方式有用sendmail得，有用smtp的。但因为我很懒。已经用过web.py得sendmail.简洁到根本不想去搞其他配置。像这样：(其实用python得标准库也很简单。)</p>
<div class="highlight"><pre><span class="n">import</span> <span class="n">web</span>
<span class="n">web</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">smtp_server</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">smtp</span><span class="p">.</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="err">&#39;</span>
<span class="n">web</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">smtp_port</span> <span class="o">=</span> <span class="mi">587</span>
<span class="n">web</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">smtp_username</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">qunfazhuanyong</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="err">&#39;</span>
<span class="n">web</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">smtp_password</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">mima</span><span class="err">&#39;</span>
<span class="n">web</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">smtp_starttls</span> <span class="o">=</span> <span class="n">True</span>
</pre></div>


<p>发送邮件就是<code>web.sendmail('qunfazhuanyong@gmail.com', receiver, title, msg ...</code></p>
                <a class="readmore" href="/git-hooks-auto-email.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/git-hooks-auto-deploy-website.html" rel="bookmark"
                           title="Permalink to git hooks 自动部署网站">git hooks 自动部署网站</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-11-10T19:42:10">
                日 10 十一月 2013
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/cao-yi-jun.html">曹逸君</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>. </p>
<p>tags: <a href="/tag/.html"></a></p>
</footer><!-- /.post-info -->                <p>git的hook提供了非常大得自由度。 
有commit发邮件啦。push后更新网站啦。做测试啦。无所不能。</p>
<p>所谓hook就是.git/hooks目录下得各种脚本。根据名字分别在不同情况下由git调用。这里post-receives是接收push结束后触发。</p>
<p><code>.git/hooks/post-receive</code></p>
<div class="highlight"><pre><span class="c">#!/bin/sh</span>
<span class="nb">echo</span> <span class="s1">&#39;auto deploy&#39;</span>
git --git-dir<span class="o">=</span>/path/blog.git/ --work-tree<span class="o">=</span>/webroot/blog reset --hard
<span class="nv">STAT</span><span class="o">=</span><span class="nv">$?</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$STAT</span> -eq 0 <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s1">&#39;deployed!&#39;</span>
<span class="k">else</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;=口= something went wrong. $STAT&quot;</span>
<span class="k">fi</span>
</pre></div>


<p>说起来被shell脚本坑了一道。<code>[ $STAT -eq 0 ]</code>和<code>[$STAT ...</code></p>
                <a class="readmore" href="/git-hooks-auto-deploy-website.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/fuck-nikola-use-pelican.html" rel="bookmark"
                           title="Permalink to 从nikola换成pelican">从nikola换成pelican</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-11-10T15:01:07">
                日 10 十一月 2013
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/cao-yi-jun.html">曹逸君</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>. </p>
<p>tags: <a href="/tag/.html"></a></p>
</footer><!-- /.post-info -->                <p>有个博客还是很重要的。
nikola默认用reStructuredText做轻量标记语言。
不知道是不是markdown先入为主。觉得RST很不好用。</p>
<p>nikola v6.2.1 的base template文件：<code>/usr/local/lib/python2.7/dist-packages/nikola/data/themes/base/templates/disqus_helper.tmpl</code></p>
<p>存在bug。有一句：</p>
<p><code>dsq.src = \'http://\' + disqus_shortname + \'.disqus.com/embed.js\';</code></p>
<p>不知道谁很想当然得写了个<code>http://</code>进去。https的网站，比如说我，就郁闷了。</p>
<p>在github上看下发现bug四天前已经被修复了。   =。= 下东西还是直接从github上下最新得比较舒服。</p>
<p>20140419 update:</p>
<p>更换为pelican。Nikola各种恼人的小bug。egg文件权限去掉了read搞得其他库都出问题。所有文章全部全文列在首页。(默认设置)。今天又发现galleries里图片文件名为中文编码出问题。虽然不是nikola的问题 ...</p>
                <a class="readmore" href="/fuck-nikola-use-pelican.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
        <a href="/tag/.html.html">&laquo;</a>
    Page 2 / 2
</p>
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>