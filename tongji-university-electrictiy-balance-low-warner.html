<!DOCTYPE html>
<html lang="zh">
<head>
      <meta charset="utf-8" />
    <title>曹逸君 Blog &middot; 同济电费过低提醒</title>
    <link rel="shortcut icon" href="http://caoyijun.com/favicon.ico" />
    <link rel="stylesheet" href="http://caoyijun.com/theme/css/screen.css" type="text/css" />
    <link rel="stylesheet" href="http://caoyijun.com/theme/css/pygments.css" type="text/css" />



</head>
<body>
    <header>
        <nav>
            <li><a href="http://caoyijun.com">Home</a></li>
            <li><a href="http://caoyijun.com/archives.html">Archives</a></li>
        </nav>
        <div class="header_box">
            <h1><a href="http://caoyijun.com">曹逸君 Blog</a></h1>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">
            <h4 class="date">11月 19, 2013</h4>
            <article class="post">
<h2 class="title">
                    <a href="http://caoyijun.com/tongji-university-electrictiy-balance-low-warner.html" rel="bookmark" title="Permanent Link to &quot;同济电费过低提醒&quot;">同济电费过低提醒</a>
                </h2>

                <p>这要从几天前宿舍突然断电说起。代码敲得正欢，卡擦。没电了。网也断了（路由断电）。</p>
<p>坑爹呢这是，宿舍一伙人第一反映，没电费了，赶紧去交。交完发现，其实我们还有200Kwh剩余。

又交了400￥.于是就有了800Kwh，估计一年都有可能用不完。而断电只是由于不明原因跳闸。</p>
<p>电费系统坑点：</p>
<p>1.预冲式，没电费了直接断电，无提示。</p>
<p>2.缴费终端查询和缴费分开，只缴费是看不到剩余的。</p>
<p>3.钱交了，想退恐怕是极难的。</p>
<p>同济有个能源网可以查剩余电量。一天一更新。<a href="nyglzx.tongji.edu.cn/web/datastat.aspx">nyglzx.tongji.edu.cn/web/datastat.aspx</a></p>
<p>这次被坑后，我含着悲愤，写了个自动检测电量得脚本<a href="https://github.com/c19/TJwarner">github repo</a></p>
<p>电量低于一点值，比如10Kwh就发邮件到我邮箱提醒我。</p>
<p>然后又想了，其他小伙伴说不定也有这个需求，就写了个简单得页面放到服务器上提供电费过低提示功能。</p>
<p>脚本写的很简陋、很难看。如果需求大得话继续改进吧。</p>
<p>话说一句print()很诡异的只在服务器上用nginx+uwsgi出编码错误(<code>ascii' codec can't encode characters</code>)</p>
<p>在本机无论是nginx+uwsgi。还是直接用web.py自带得webserver都没问题，在服务器上就执着得报错，还偶尔不报，非常郁闷。</p>
<p>喔。地址是<a href="http://tjwarner.caoyijun.com/">http://tjwarner.caoyijun.com/</a></p>
<p>11-25 更新，有7、8个用户，但以脚本抓取得方式很不稳定，查询网站时常timeout。(可能VPS在海外得关系)。</p>
<p>信息源不稳定真是个很痛苦得事情，要做很多补丁式得东西。重试、预测等(能源网一天更新一次)。</p>

                <div class="clear"></div>
                <div class="info">
                    <a href="http://caoyijun.com/tongji-university-electrictiy-balance-low-warner.html">posted at 22:47</a>
                </div>

            </article>
            <div class="clear"></div>
            <div class="clear"></div>
            <footer>
                <p>
                <a href="https://github.com/jody-frankowski/blue-penguin">Blue Penguin</a> Theme
                &middot;
                Powered by <a href="http://getpelican.com">Pelican</a>
            </footer>
        </div>
        <div class="clear"></div>
    </div>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-33228021-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>
	<script type="text/javascript"
		src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	</script>
</body>
</html>